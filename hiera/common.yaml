---
# Hosts & IPs
# CHANGEME
# Edit the following line to set a test user password:
deployments::profile::users::password: "test"
# Edit the following subnet to match your network:
neutron_subnet:
  Subnet1:
    gateway_ip: 10.190.0.1
    network_name: Network1
    cidr: 10.190.0.0/24
    allocation_pools:
      - start=10.190.0.5,end=10.190.0.254
    enable_dhcp: false
    dns_nameservers:
     - 8.8.8.8
     - 8.8.4.4
control_node: &control_node '127.0.0.1'

# Version of CirrOS to install
deployments::profile::glance::cirros_version: "0.3.4"

# Set to true to enable debug mode!
debug: &debug "false"
keystone::debug: *debug
cinder::debug: *debug
ceilometer::debug: *debug
glance::api::debug: *debug
glance::registry::debug: *debug
ironic::debug: *debug
ironic::logging::debug: *debug
nova::debug: *debug
neutron::debug: *debug
neutron::agents::l3::debug: *debug
neutron::agents::dhcp::debug: *debug
neutron::agents::metadata::debug: *debug

# Set to true to enable verbose mode!
verbose: &verbose "false"
keystone::verbose: *verbose
cinder::verbose: *verbose
ceilometer::verbose: *verbose
glance::api::verbose: *verbose
glance::registry::verbose: *verbose
ironic::verbose: *verbose
ironic::logging::verbose: *verbose
nova::verbose: *verbose
neutron::agents::l3::verbose: *debug
neutron::agents::dhcp::verbose: *debug
neutron::agents::metadata::verbose: *verbose

# Passwords
admin_password: &admin_password "admin_pass"
admin_tenant: &admin_tenant "openstack"
admin_user: &admin_user "admin"
region_name: &region_name "RegionOne"
keystone::admin_token: "secret_token"
keystone::roles::admin::password: *admin_password
keystone::roles::admin::admin_tenant: *admin_tenant
keystone::roles::admin::admin: *admin_user
keystone::roles::admin::email: "root@%{hiera('control_node')}"
keystone::roles::admin::admin_roles:
 - 'admin'
 - '_member_'
 - 'SwiftOperator'
glance::keystone::auth::password: &service_user_pass "service_user_pass"
glance::api::keystone_password: *service_user_pass
glance::registry::keystone_password: *service_user_pass
cinder::api::keystone_password: *service_user_pass
cinder::keystone::auth::password: *service_user_pass
ceilometer::keystone::auth::password: *service_user_pass
ceilometer::api::keystone_password: *service_user_pass
swift::keystone::auth::password: *service_user_pass
swift::proxy::authtoken::admin_password: *service_user_pass
ironic::keystone::auth::password: *service_user_pass
ironic::api::admin_password: *service_user_pass
nova::keystone::auth::password: *service_user_pass
neutron::keystone::auth::password: *service_user_pass
nova::api::admin_password: *service_user_pass
neutron::server::auth_password: *service_user_pass
neutron::server::notifications::password: *service_user_pass
neutron::agents::metadata::auth_password: *service_user_pass
neutron::agents::metadata::shared_secret: &shared_secret "something_secret"

# Database stuff
glance::registry::database_connection: &glance_db_connection "mysql://%{hiera('glance::db::mysql::user')}:%{hiera('glance::db::mysql::password')}@%{hiera('control_node')}/glance"
glance::api::database_connection: *glance_db_connection
glance::db::mysql::password: "db_pass"
glance::db::mysql::user: "glance"
glance::db::mysql::allowed_hosts: *control_node
keystone::database_connection: "mysql://%{hiera('keystone::db::mysql::user')}:%{hiera('keystone::db::mysql::password')}@%{hiera('control_node')}/keystone"
keystone::db::mysql::password: "db_pass"
keystone::db::mysql::user: "keystone"
keystone::db::mysql::allowed_hosts: *control_node
cinder::database_connection: "mysql://%{hiera('cinder::db::mysql::user')}:%{hiera('cinder::db::mysql::password')}@%{hiera('control_node')}/cinder"
cinder::db::mysql::password: "db_pass"
cinder::db::mysql::user: "cinder"
cinder::db::mysql::allowed_hosts: *control_node
ceilometer::db::database_connection: "mysql://%{hiera('ceilometer::db::mysql::user')}:%{hiera('ceilometer::db::mysql::password')}@%{hiera('control_node')}/ceilometer"
ceilometer::db::mysql::password: "db_pass"
ceilometer::db::mysql::user: "ceilometer"
ceilometer::db::mysql::allowed_hosts: *control_node
ironic::db::database_connection: "mysql://%{hiera('ironic::db::mysql::user')}:%{hiera('ironic::db::mysql::password')}@%{hiera('control_node')}/ironic"
ironic::db::mysql::password: "db_pass"
ironic::db::mysql::user: "ironic"
ironic::db::mysql::allowed_hosts: *control_node
nova::db::database_connection: "mysql://%{hiera('nova::db::mysql::user')}:%{hiera('nova::db::mysql::password')}@%{hiera('control_node')}/nova"
nova::db::mysql::password: "db_pass"
nova::db::mysql::user: "nova"
nova::db::mysql::allowed_hosts: *control_node
neutron::server::database_connection: "mysql://%{hiera('neutron::db::mysql::user')}:%{hiera('neutron::db::mysql::password')}@%{hiera('control_node')}/neutron"
neutron::db::mysql::password: "db_pass"
neutron::db::mysql::user: "neutron"
neutron::db::mysql::allowed_hosts: *control_node

# Sync DB: should be true, don't change this
sync_db: &sync_db true
cinder::api::sync_db: *sync_db
ceilometer::db::sync_db: *sync_db
ironic::sync_db: *sync_db
nova::api::sync_db: *sync_db
neutron::server::sync_db: *sync_db
keystone::sync_db: *sync_db
glance::registry::sync_db: *sync_db

# Package Ensures
package_ensure: &package_ensure "latest"
cinder::package_ensure: *package_ensure
cinder::volume::package_ensure: *package_ensure
cinder::client::package_ensure: *package_ensure
cinder::scheduler::package_ensure: *package_ensure
ceilometer::package_ensure: *package_ensure
ceilometer::client::ensure: *package_ensure
ceilometer::agent::compute: *package_ensure
keystone::package_ensure: *package_ensure
glance::package_ensure: *package_ensure
glance::api::package_ensure: *package_ensure
glance::registry::package_ensure: *package_ensure
horizon::package_ensure: *package_ensure
ironic::package_ensure: *package_ensure
ironic::api::package_ensure: *package_ensure
ironic::client::package_ensure: *package_ensure
ironic::conductor::package_ensure: *package_ensure
nova::client::ensure: *package_ensure
nova::ensure_package: *package_ensure
nova::cert::ensure_package: *package_ensure
nova::compute::ensure_package: *package_ensure
nova::conductor::ensure_package: *package_ensure
nova::consoleauth::ensure_package: *package_ensure
nova::scheduler::ensure_package: *package_ensure
nova::vncproxy::ensure_package: *package_ensure
neutron::client::ensure_package: *package_ensure
neutron::server::ensure_package: *package_ensure
neutron::ensure_package: *package_ensure
neutron::plugins::ml2::ensure_package: *package_ensure
openstacklib::openstackclient::package_ensure: *package_ensure
swift::client::ensure: *package_ensure
swift::package_ensure: *package_ensure
swift::storage::generic::package_ensure: *package_ensure
swift::storage::object::package_ensure: *package_ensure
swift::storage::container::package_ensure: *package_ensure
swift::storage::account::package_ensure: *package_ensure
swift::proxy::package_ensure: *package_ensure

# Endpoint stuff
keystone::public_endpoint: &keystone_public_endpoint "http://%{hiera('control_node')}:5000"
keystone::admin_endpoint: &keystone_admin_endpoint "http://%{hiera('control_node')}:35357"
keystone::endpoint::public_url: *keystone_public_endpoint
keystone::endpoint::admin_url: *keystone_admin_endpoint
# Keystone v3 uses versionless endpoints
keystone::endpoint::version: ''
glance::keystone::auth::public_url: &glance_url "http://%{hiera('control_node')}:9292"
glance::keystone::auth::internal_url: *glance_url
glance::keystone::auth::admin_url: *glance_url
ironic::keystone::auth::public_url: &ironic_url "http://%{hiera('control_node')}:6385"
ironic::keystone::auth::internal_url: *ironic_url
ironic::keystone::auth::admin_url: *ironic_url
cinder::keystone::auth::public_url: &cinder_api_url "http://%{hiera('control_node')}:8776/v1/%(tenant_id)s"
cinder::keystone::auth::internal_url: *cinder_api_url
cinder::keystone::auth::admin_url: *cinder_api_url
cinder::keystone::auth::public_url_v2: &cinder_api_url_v2 "http://%{hiera('control_node')}:8776/v2/%(tenant_id)s"
cinder::keystone::auth::internal_url_v2: *cinder_api_url_v2
cinder::keystone::auth::admin_url_v2: *cinder_api_url_v2
ceilometer::keystone::auth::public_url: &ceilometer_api_url "http://%{hiera('control_node')}:8777"
ceilometer::keystone::auth::internal_url: *ceilometer_api_url
ceilometer::keystone::auth::admin_url: *ceilometer_api_url
nova::keystone::auth::configure_ec2_endpoint: false
nova::keystone::auth::internal_url: &nova_api_url "http://%{hiera('control_node')}:8774/v2/%(tenant_id)s"
nova::keystone::auth::public_url: *nova_api_url
nova::keystone::auth::admin_url: *nova_api_url
nova::keystone::auth::internal_url_v3: *nova_api_url
nova::keystone::auth::public_url_v3: *nova_api_url
nova::keystone::auth::admin_url_v3: *nova_api_url
swift::keystone::auth::public_url: &swift_api_url "http://%{hiera('control_node')}:8080/v1/%{hiera('swift::proxy::keystone::reseller_prefix')}%(tenant_id)s"
swift::keystone::auth::internal_url: *swift_api_url
swift::keystone::auth::admin_url: "http://%{hiera('control_node')}:8080/v1"
neutron::keystone::auth::public_url: &neutron_api_url "http://%{hiera('control_node')}:9696"
neutron::keystone::auth::internal_url: *neutron_api_url
neutron::keystone::auth::admin_url: *neutron_api_url

# Auth_uri = Public_Uri = port 5000
# Identity_uri = Admin_Uri = port 35357
nova::api::auth_uri: *keystone_public_endpoint
nova::api::identity_uri: *keystone_admin_endpoint
nova::network::neutron::neutron_admin_auth_url: *keystone_admin_endpoint
neutron::api::auth_uri: *keystone_public_endpoint
neutron::api::identity_uri: *keystone_admin_endpoint
neutron::server::auth_uri: *keystone_public_endpoint
neutron::server::identity_uri: *keystone_admin_endpoint
neutron::server::notifications::auth_uri: *keystone_public_endpoint
neutron::server::notifications::identity_uri: *keystone_admin_endpoint
ceilometer::api::keystone_auth_uri: *keystone_public_endpoint
ceilometer::api::keystone_identity_uri: *keystone_admin_endpoint
cinder::api::auth_uri: *keystone_public_endpoint
# This seems to need a version on the endpoint to avoid #LP1521639
cinder::api::keymgr_encryption_auth_url: "http://%{hiera('control_node')}:5000/v3"
cinder::api::identity_uri: *keystone_admin_endpoint
glance::api::auth_uri: *keystone_public_endpoint
glance::api::identity_uri: *keystone_admin_endpoint
glance::registry::auth_uri: *keystone_public_endpoint
glance::registry::identity_uri: *keystone_admin_endpoint
ironic::api::auth_uri: *keystone_public_endpoint
ironic::api::identity_uri: *keystone_admin_endpoint
neutron::server::identity_uri: *keystone_admin_endpoint
swift::proxy::authtoken::auth_uri: *keystone_public_endpoint
swift::proxy::authtoken::identity_uri: *keystone_admin_endpoint

# Nova stuff
nova::os_region_name: *region_name
nova::api::resume_guests_state_on_host_boot: true
nova::api::service_neutron_metadata_proxy: true
nova::vncproxy::host: "%{hiera('control_node')}"
nova::api::enabled: true
nova::cert::enabled: true
nova::compute::enabled: true
nova::consoleauth::enabled: true
nova::conductor::enabled: true
nova::scheduler::enabled: true
nova::vncproxy::enabled: true
nova::volume::enabled: true
nova::compute::vnc_enabled: true
nova::api::neutron_metadata_proxy_shared_secret: *shared_secret
nova::compute::libvirt::libvirt_virt_type: 'qemu'
nova::compute::libvirt::migration_support: true
nova::compute::libvirt::vncserver_listen: '0.0.0.0'
nova::glance_api_servers: *glance_url
nova::network::neutron::neutron_region_name: "%{hiera('region_name')}"
nova::network::neutron::neutron_admin_password: *service_user_pass
# This below will not work without a version on the endpoint.
nova::network::neutron::neutron_admin_auth_url: "%{hiera('keystone::admin_endpoint')}/v2.0"
nova::network::neutron::neutron_url: "http://%{hiera('control_node')}:9696"

# Rabbit
rabbitmq::server::node_ip_address: '0.0.0.0'
rabbit_password: &rabbit_password "elmer_fudd"
rabbit_host: &rabbit_host "%{hiera('control_node')}"
rabbit_user: &rabbit_user "rabbit_user"
rabbitmq::server::port: 5672
rabbitmq::delete_guest_user: true
ceilometer::rabbit_host: *rabbit_host
ceilometer::rabbit_password: *rabbit_password
ceilometer::rabbit_userid: *rabbit_user
cinder::rabbit_host: *rabbit_host
cinder::rabbit_password: *rabbit_password
cinder::rabbit_userid: *rabbit_user
ironic::rabbit_host: *rabbit_host
ironic::rabbit_password: *rabbit_password
ironic::rabbit_userid: *rabbit_user
nova::rabbit_password: *rabbit_password
nova::rabbitmq::password: *rabbit_password
nova::rabbit_host: *rabbit_host
nova::rabbitmq::userid: *rabbit_user
nova::rabbit_userid: *rabbit_user
neutron::rabbit_host: *rabbit_host
neutron::rabbit_password: *rabbit_password
neutron::rabbit_user: *rabbit_user

# horizon
horizon::secret_key: 'abcfedghijklmnopqrstuvwxyz1234567890'
horizon::keystone_url: "http://%{hiera('control_node')}:5000/v3"
# Note: insecure change to your IP Address if desired for better security
horizon::allowed_hosts:
 - "*"
horizon::api_versions:
    'identity': 3
horizon::compress_offline: false
apache::default_vhost: false

# Keystone
keystone::wsgi::apache::ssl: false
keystone::service_name: 'httpd'

# cinder stuff
cinder::setup_test_volume::size: 10G
cinder::setup_test_volume::volume_path: '/var/lib/cinder/volumes'

# Neutron
neutron::allow_overlapping_ips: true
neutron::core_plugin: 'ml2'
neutron::service_plugin:
 - 'router'
neutron::plugins::ml2::type_drivers:
 - 'vxlan'
neutron::plugins::ml2::tenant_network_types:
 - 'vxlan'
neutron::plugins::ml2::mechanism_drivers:
 - 'openvswitch'
neutron::agents::ml2::ovs::enable_tunneling: true
neutron::agents::ml2::ovs::local_ip: '127.0.0.1'
neutron::agents::ml2::ovs::tunnel_types:
 - 'vxlan'
neutron::service_plugins:
 - 'router'
neutron_network:
  Network1:
    shared: true
    router_external: true
    provider_network_type: 'vxlan'
    ensure: present
neutron::server::notifications::os_region_name: *region_name

# Ceilometer
ceilometer::metering_secret: "ceilometer_secret"
ceilometer::api::enabled: true

# Swift
swift::keystone::auth::configure_endpoint: true
swift::keystone::auth::configure_s3_endpoint: false
swift::swift_hash_suffix: 'secret_hash'
swift::storage: '127.0.0.1'
swift::proxy::pipeline:
 - 'catch_errors'
 - 'healthcheck'
 - 'cache'
 - 'tempurl'
 - 'ratelimit'
 - 'authtoken'
 - 'keystone'
 - 'formpost'
 - 'staticweb'
 - 'container_quotas'
 - 'account_quotas'
 - 'proxy-logging'
 - 'proxy-server'
swift::proxy::keystone::operator_roles:
 - '_member_'
 - 'admin'
 - 'SwiftOperator'
swift::keystone::auth::operator_roles:
 - 'admin'
 - 'SwiftOperator'
 - 'ResellerAdmin'
swift::proxy::keystone::reseller_prefix: 'KEY_'
swift::proxy::proxy_local_net_ip: '127.0.0.1'
swift::storage::all::storage_local_net_ip: '127.0.0.1'
swift::storage::all::incoming_chmod: 'Du=rwx,g=rx,o=rx,Fu=rw,g=r,o=r'
swift::storage::all::outcoming_chmod: 'Du=rwx,g=rx,o=rx,Fu=rw,g=r,o=r'
swift_ring_object_devices:
  '127.0.0.1:6000/1':
    'zone': 1
    'weight': 1
  '127.0.0.1:6000/2':
    'zone': 1
    'weight': 1
swift_ring_container_devices:
  '127.0.0.1:6001/1':
    'zone': 1
    'weight': 1
  '127.0.0.1:6001/2':
    'zone': 1
    'weight': 1
swift_ring_account_devices:
  '127.0.0.1:6002/1':
    'zone': 1
    'weight': 1
  '127.0.0.1:6002/2':
    'zone': 1
    'weight': 1

# Ironic stuff
ironic::enable_drivers:
  - 'pxe_ssh'

# test user & openrc stuff
deployments::profile::users::project: "test_project"
deployments::profile::users::username: "test"
deployments::profile::users::roles:
 - '_member_'
 - 'SwiftOperator'
deployments::profile::openrcs::openrcs:
  "%{hiera('admin_user')}":
     "path": "/root/openrc.%{hiera('admin_user')}"
     "tenant": "%{hiera('admin_tenant')}"
     "user": "%{hiera('admin_user')}"
     "password": "%{hiera('admin_password')}"
  "%{hiera('deployments::profile::users::username')}":
     "path": "/root/openrc.%{hiera('deployments::profile::users::username')}"
     "tenant": "%{hiera('deployments::profile::users::project')}"
     "user": "%{hiera('deployments::profile::users::username')}"
     "password": "%{hiera('deployments::profile::users::password')}"
