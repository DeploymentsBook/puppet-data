---
# Hosts & IPs
control_node: &control_node 'localhost'

# Version of CirrOS to install
deployments::profile::glance::cirros_version: "0.3.4"

# Set to true to enable debug mode!
debug: &debug "false"
keystone::debug: *debug
cinder::debug: *debug
glance::api::debug: *debug
glance::registry::debug: *debug
nova::debug: *debug
neutron::debug: *debug
neutron::agents::l3::debug: *debug
neutron::agents::dhcp::debug: *debug

# Set to true to enable verbose mode!
verbose: &verbose "false"
keystone::verbose: *verbose
cinder::verbose: *verbose
glance::api::verbose: *verbose
glance::registry::verbose: *verbose
nova::verbose: *verbose
neutron::agents::l3::verbose: *debug
neutron::agents::dhcp::verbose: *debug

# Passwords & Openrc
admin_password: &admin_password "admin_pass"
admin_tenant: &admin_tenant "openstack"
admin_user: &admin_user "admin"
region_name: &region_name "RegionOne"
keystone::admin_token: "secret_token"
keystone::roles::admin::password: *admin_password
keystone::roles::admin::admin_tenant: *admin_tenant
keystone::roles::admin::admin: *admin_user
keystone::roles::admin::email: "root@%{hiera('control_node')}"
glance::keystone::auth::password: &service_user_pass "service_user_pass"
glance::api::keystone_password: *service_user_pass
glance::registry::keystone_password: *service_user_pass
cinder::api::keystone_password: *service_user_pass
cinder::keystone::auth::password: *service_user_pass
nova::keystone::auth::password: *service_user_pass
nova::api::admin_password: *service_user_pass
neutron::server::auth_password: *service_user_pass
neutron::server::notifications::nova_admin_password: *service_user_pass

# Database stuff
glance::registry::database_connection: &glance_db_connection "mysql://%{hiera('glance::db::mysql::user')}:%{hiera('glance::db::mysql::password')}@%{hiera('control_node')}/glance"
glance::api::database_connection: *glance_db_connection
glance::db::mysql::password: &db_pass "db_pass"
glance::db::mysql::user: "glance"
glance::db::mysql::allowed_hosts: *control_node
keystone::database_connection: "mysql://%{hiera('keystone::db::mysql::user')}:%{hiera('keystone::db::mysql::password')}@%{hiera('control_node')}/keystone"
keystone::db::mysql::password: &db_pass "db_pass"
keystone::db::mysql::user: "keystone"
keystone::db::mysql::allowed_hosts: *control_node
cinder::database_connection: "mysql://%{hiera('cinder::db::mysql::user')}:%{hiera('cinder::db::mysql::password')}@%{hiera('control_node')}/cinder"
cinder::db::mysql::password: &db_pass "db_pass"
cinder::db::mysql::user: "cinder"
cinder::db::mysql::allowed_hosts: *control_node
nova::db::database_connection: "mysql://%{hiera('nova::db::mysql::user')}:%{hiera('nova::db::mysql::password')}@%{hiera('control_node')}/nova"
nova::db::mysql::password: &db_pass "db_pass"
nova::db::mysql::user: "nova"
nova::db::mysql::allowed_hosts: *control_node
neutron::server::database_connection: "mysql://%{hiera('nova::db::mysql::user')}:%{hiera('neutron::db::mysql::password')}@%{hiera('control_node')}/neutron"
neutron::db::mysql::password: &db_pass "db_pass"
neutron::db::mysql::user: "neutron"
neutron::db::mysql::allowed_hosts: *control_node

# Sync DB: should be true
sync_db: &sync_db true
cinder::api::sync_db: *sync_db
nova::api::sync_db: *sync_db
neutron::server::sync_db: *sync_db
keystone::sync_db: *sync_db
glance::registry::sync_db: *sync_db

# Package Ensures
cinder::package_ensure: "latest"
cinder::volume::package_ensure: "latest"
cinder::client::package_ensure: "latest"
cinder::scheduler::package_ensure: "latest"
keystone::package_ensure: "latest"
glance::package_ensure: "latest"
glance::api::package_ensure: "latest"
glance::registry::package_ensure: "latest"
horizon::package_ensure: "latest"
nova::api::enabled: true
nova::cert::enabled: true
nova::compute::enabled: true
nova::conductor::enabled: true
nova::objectstore::enabled: true
nova::scheduler::enabled: true
nova::vncproxy::enabled: true
nova::volume::enabled: true
nova::client::ensure: "latest"
nova::ensure_package: "latest"
nova::compute::ensure_package: "latest"
openstacklib::openstackclient::package_ensure: "latest"

# Endpoint stuff
keystone::public_endpoint: &public_endpoint "http://%{hiera('control_node')}:5000"
keystone::admin_endpoint: &admin_endpoint "http://%{hiera('control_node')}:35357"
keystone::endpoint::public_url: *public_endpoint
keystone::endpoint::admin_url: *admin_endpoint
glance::keystone::auth::public_url: &glance_url "http://%{hiera('control_node')}:9292"
glance::keystone::auth::internal_url: *glance_url
glance::keystone::auth::admin_url: *glance_url
cinder::keystone::auth::public_url: &cinder_api_url "http://%{hiera('control_node')}:8776/v1/%(tenant_id)s"
cinder::keystone::auth::internal_url: *cinder_api_url
cinder::keystone::auth::admin_url: *cinder_api_url
nova::keystone::auth::configure_ec2_endpoint: false
nova::keystone::auth::internal_url: &nova_api_url "http://%{hiera('control_node')}:8774/v2/%(tenant_id)s"
nova::keystone::auth::public_url: *nova_api_url
nova::keystone::auth::admin_url: *nova_api_url
nova::api::auth_uri: &auth_uri "http://%{hiera('control_node')}:5000"
nova::api::identity_uri: &identity_uri "http://%{hiera('control_node')}:35357"
cinder::api::auth_uri: *auth_uri
cinder::api::identity_uri: *identity_uri
glance::api::auth_uri: *auth_uri
glance::api::identity_uri: *identity_uri
glance::registry::auth_uri: *auth_uri
glance::registry::identity_uri: *identity_uri
neutron::server::identity_uri: *identity_uri

# Nova stuff
nova::os_region_name: *region_name
nova::api::resume_guests_state_on_host_boot: true
nova::api::service_neutron_metadata_proxy: true
nova::vncproxy::host: "%{hiera('control_node')}"

# Rabbit
rabbitmq::server::node_ip_address: '0.0.0.0'
rabbit_password: &rabbit_password "elmer_fudd"
cinder::rabbit_password: *rabbit_password
neutron::rabbit_password: *rabbit_password
nova::rabbit_password: *rabbit_password
nova::rabbitmq::password: *rabbit_password
rabbit_host: &rabbit_host "%{hiera('control_node')}"
cinder::rabbit_host: *rabbit_host
nova::rabbit_host: *rabbit_host
neutron::rabbit_host: *rabbit_host
rabbit_user: &rabbit_user "rabbit_user"
cinder::rabbit_userid: *rabbit_user
nova::rabbitmq::userid: *rabbit_user
nova::rabbit_userid: *rabbit_user
neutron::rabbit_user: *rabbit_user
rabbitmq::server::port: 5672

# horizon
horizon::secret_key: 'abcfedghijklmnopqrstuvwxyz1234567890'
horizon::keystone_url: "http://%{hiera('control_node')}:5000/v2"
horizon::allowed_hosts:
 - "*"
horizon::compress_offline: false

# Keystone
keystone::wsgi::apache::ssl: false
keystone::service_name: 'httpd'

deployments::profile::users::project: "test_project"
deployments::profile::users::username: "test"
deployments::profile::users::password: "test"

# cinder stuff
cinder::setup_test_volume::size: 10G
cinder::setup_test_volume::volume_path: '/var/lib/cinder/volumes'

# neutron stuff
neutron::allow_overlapping_ips: true
neutron::core_plugin: 'ml2'
neutron::service_plugin:
 - 'router'
neutron::plugins::ml2:type_drivers:
 - 'vxlan'
neutron::plugins::ml2:tenant_network_types:
 - 'vxlan'
neutron::plugins::ml2:mechanism_drivers:
 - 'openvswitch'
neutron::agents::ml2::ovs:enable_tunneling: true
neutron::agents::ml2::ovs:local_ip: '127.0.0.1'
neutron::agents::ml2::ovs:tunnel_types:
 - 'vxlan'

# openrc stuff
deployments::profile::openrcs::openrcs:
  "%{hiera('admin_user')}":
     "path": "/root/openrc.%{hiera('admin_user')}"
     "tenant": "%{hiera('admin_tenant')}"
     "user": "%{hiera('admin_user')}"
     "password": "%{hiera('admin_password')}"
  "%{hiera('deployments::profile::users::username')}":
     "path": "/root/openrc.%{hiera('deployments::profile::users::username')}"
     "tenant": "%{hiera('deployments::profile::users::project')}"
     "user": "%{hiera('deployments::profile::users::username')}"
     "password": "%{hiera('deployments::profile::users::password')}"
